% !TEX root = ../func_top.tex

\section{Generalized Morse inequalities} \label{s:inequalities}

In this section we prove that $q$-tame persistence modules satisfy a general version of Morse inequalities that specializes to the usual Morse inequalities in the smooth context, as well as to the version used by Morse and Tompkins to prove their Unstable Minimal Surface Theorem.
We deduce these general inequalities from the existence of persistence diagrams as reviewed in \cref{t:q-tame modules have barcodes}.

Recall that for a Morse function $f$ on a closed smooth manifold $X$, the usual Morse inequalities state that for any non-negative integer $n$ the following holds:
\begin{equation} \label{e:classical morse inequalities}
\sum_{d=0}^n \ (-1)^{n-d} \big( \# \crit_{d}(f) - \beta_{d}(X) \big) \ \geq \ 0,
\end{equation}
where $\crit_{d}(f)$ is the set of critical points of $f$ with index $d$ and $\beta_{d}(X)$ is the $d\th$ Betti number of $X$.

If no two critical points of $f$ have the same value, the sets of critical points and values are naturally in one-to-one correspondence, which, in turn, are in one-to-one correspondence with the homological changes in the sublevel set filtration of $f$, i.e., the endpoints of the intervals appearing in the barcode of the persistent homology of $f_{\leq \bullet}$.
More precisely, an index $d$ critical point may either kill an existing homology class, in which case it corresponds to the right endpoint of an interval in the barcode of $H_{d-1}(f_{\leq \bullet})$, or it may give rise to a new homology class, in which case it corresponds to the left endpoint of an interval in the barcode of $H_d(f_{\leq \bullet})$.

The Betti numbers of $X$ may also be expressed in terms of barcodes because they agree with the number of intervals that extend to $+\infty$.
Thus, the Morse inequalities above can be expressed entirely in terms of the barcode (or persistence diagram) of the persistent homology of the sublevel set filtration of the function, which encodes the homological changes in the filtration.

This approach of counting homological changes instead of critical points is also what Morse used in the non-smooth setting of functional topology.
To keep track of the number of $d$-dimensional homological events at filtration value $t$ that persist for at least time $\epsilon > 0$ but not indefinitely, \cite{Morse.1940} defined the $(d, t, \epsilon)$-\emph{cap numbers} of a filtration, which, when the associated persistence module has a barcode and is continuous from above, correspond to the number of finite bars with length greater than $\epsilon$ in the $d\th$ barcode with left endpoint $t$, plus the number of finite bars with length greater than $\epsilon$ in the $(d-1)\th$ barcode with right endpoint $t$ (killed by something $d$-dimensional).

Working entirely in the algebraic setting, we will now fix a graded q-tame persistence module $M$.
Of course, one may think of $M$ as the persistent homology of a q-tame filtration, but $M$ could for example also arise as the filtered Floer homology of some Hamiltonian on a symplectic manifold.
By \cref{t:q-tame modules have barcodes}, $M$ has a persistence diagram in every degree $d$ with multiplicity function denoted $\m_d \colon \mulDom \to \N$.
In analogy to Morse's definitions, we may define the $(d, t, \epsilon)$-\emph{cap number} of our graded q-tame persistence module $M$ in terms of its persistence diagram as
\begin{equation*}
c_{d}^{\epsilon}(t) \ =
\sum_{\substack{p \in \R \\ t - p > \epsilon}} \m_{d-1}(p, t) \ +
\sum_{\substack{q \in \R \\ q - t > \epsilon}} \m_d(t, q).
\end{equation*}
Note that finiteness of these quantities is ensured by the q-tameness of $M$ and the use of a non-zero $e$ bounding below the persistence of the considered features.
To see the necessity of this second condition, consider the q-tame persistence module given by the infinite product $\prod_{n \in \N_{> 0}} C([0,1/n))$.

Whenever the sums below are well-defined, we also consider the \emph{$(d,\epsilon)$-cap numbers} 
\[
c_{d}^{\epsilon} =
\sum_{t} c_{d}^{\epsilon}(t) \ =
\sum_{\substack{(p,q) \in \mulDom \\ q - p > \epsilon \\ q \neq \infty}} \m_{d-1}(p,q) \ +
\sum_{\substack{(p,q) \in \mulDom \\ q - p > \epsilon \\ p \neq -\infty}}\m_d(p,q).
\]
An important setting where all cap numbers are well-defined is when $M$ is the persistent homology of the sublevel set filtration of a bounded function.
A more general statement can be made using the following notion.

\begin{defi} \label{d:initially and eventually constant}
	A persistence module $N$ is said to be \emph{initially constant} if there is $s \in \R$ such that $N_{r,s}$ is an isomorphism for all $r \leq s$.
	Similarly, it is said to be \emph{eventually constant} if there is $u \in \R$
	such that $N_{u,v}$ is an isomorphism for all $u \leq v$.
\end{defi}

\begin{thm} \label{t:cap numbers well defined}
	Let $N$ be a q-tame persistence module that is both initially and eventually constant.
	If $\n$ is the multiplicity function of the persistence diagram of $N$,
	then for each $\epsilon > 0$,
	\begin{equation*}
	\sum_{ \substack{ (p,q) \in \mulDom \\ q-p > \epsilon } } \n (p,q) < \infty.
	\end{equation*}
\end{thm}

\begin{proof}
	Let $s, u \in \R$ be as in \cref{d:initially and eventually constant}.
	We split the sum whose finiteness we want to show in two parts
	\begin{equation*}
	\sum_{ \substack{ (p,q) \in \mulDom \\ q-p > \epsilon } } \n (p,q) \ = \!\!
	\sum_{ \substack{ (p,q) \in \mulDom \setminus T \\ q-p > \epsilon } } \n (p,q) \ +
	\sum_{ \substack{ (p,q) \in T \\ q-p > \epsilon } } \n (p,q)
	\end{equation*}
	where $T$ denotes the triangle
	\begin{equation*}
	T = \{(p,q) \in \mulDom \mid t_0 \leq p < q \leq t_1\}.
	\end{equation*}

	For the first summand, observe that, because $N$ is constant below $s$ and constant above $u$, we have $\n(p,q) = 0$ whenever one of $-\infty < p < s$ or $q < s$ or $p > u$ or $u < q < \infty$ holds.
	This implies
	\begin{equation*}
	\sum_{ \substack{ (p,q) \in \mulDom \setminus T \\ q-p > \epsilon } } \n (p,q)
	\ = \!
	\sum_{s < q < u} \n (-\infty,q)
	\ + \!
	\sum_{s < p < u} \n (p, \infty)
	\end{equation*}
	which is clearly finite because $N$ is q-tame.

	For the second summand, note that
	\begin{equation*}
	\sum_{ \substack{ (p,q) \in T \\ q-p > \epsilon } } \n (p,q)
	\ \, \leq \!\!
	\sum_{(p,q) \in T^{\epsilon}} \n (p,q),
	\end{equation*}
	where $T^{\epsilon}$ is the smaller triangle
	\begin{equation*}
	T^{\epsilon} = \{(p,q) \in T \mid q-p \geq \epsilon\}.
	\end{equation*}
	Thus, in order to prove the theorem, it suffices to show that we have
	\begin{equation*}
	\sum_{(p,q) \in T^{\epsilon}} \n (p,q)
	\ < \
	\infty.
	\end{equation*}
	To do this, we consider open quadrants
	\begin{equation*}
	Q(x, y) = \{ (p, q) \in \R^2 \mid p < x \text{ and } y < q \}.
	\end{equation*}
	Covering the compact set $T^{\epsilon}$ by the open quadrants $Q \left(x, x + \frac{\epsilon}{2} \right)$ for $x \in \R$, we may choose a finite subcover given by, say, $x_1,\dots, x_n$.
	We obtain
	\begin{equation*}
	\sum_{(p,q) \in T^{\geq e}} \n (p,q)
	\ \leq \
	\sum_{i=1}^n \sum_{\substack{(p, q) \in \\ Q (x_i, x_i + \frac{\epsilon}{2})}} \n(p,q).
	\end{equation*}
	Each of the sums $\sum_{(p,q) \in Q \left(x_i, x_i + \frac{\epsilon}{2} \right)} \n(p,q)$ over the quadrants $Q \left(x_i, x_i + \frac{\epsilon}{2} \right)$ is finite since $N$ is q-tame (which is where the name q-tame or \emph{quadrant}-tame comes from, see \cite[Section 3.8]{Chazal.2016a}).
\end{proof}

Comparing to the usual Morse inequalities, the cap numbers in dimension $d$ act like the number of critical points with index $d$.
As an analogue to the Betti numbers of the manifold appearing in the usual Morse inequalities, Morse defines quantities $p_{d}$ referred to as \emph{essential dimensions}, which, under the same assumptions as before, can be expressed in the language of persistence diagrams as
\[
p_{d} \ = \!\! \sum_{p \in \R \cup \{-\infty\}} \m_d(p,\infty),
\]
which is also the dimension of the colimit of the degree $d$ part of $M$.

\begin{thm} \label{t:inequalities}
	Let $M$ be a graded q-tame persistence module with finite cap numbers $c_{d}^{\epsilon}$ and finite essential dimensions $p_{d}$ for all $d$ and $\epsilon$.
	If $\m_d(-\infty, p) = 0$ for all $p \in \R \cup \{\infty\}$ and all $d$, then we have Morse inequalities
	\begin{equation} \label{e:morse inequalities}
	\sum_{d=0}^n \ (-1)^{n-d} (c_{d}^{\epsilon} - p_{d}) \ \geq\ 0
	\end{equation}
	for any dimension $n$ and any $\epsilon > 0$.
\end{thm}

\begin{proof}
	Using a telescopic sum argument, the claimed inequalities can be seen to be equivalent to the existence of a sequence $(\nu_d)_d$ of non-negative integers with $c_{d}^{\epsilon} - p_{d} = \nu_{d-1} + \nu_{d}$.
	Since we assume $\m_d(-\infty, p) = 0$ for all $p$, we have
	\begin{align*}
	c_{d}^{\epsilon} \ &=
	\sum_{\substack{(p,q) \in \mulDom \\ q-p > \epsilon \\ q \neq \infty}} \m_{d-1}(p,q) \ +
	\sum_{\substack{(p,q) \in \mulDom \\ q-p > \epsilon \\ p \neq -\infty}} \m_d(p,q) \ =
	\sum_{\substack{(p,q) \in \R^2 \\ q-p > \epsilon }} \m_{d-1}(p,q) \ +
	\sum_{\substack{(p,q) \in \mulDom \\ q-p > \epsilon \\ p \neq -\infty}} \m_d(p,q)
	\end{align*}
	and
	\begin{equation*}
	p_{d} \ = \!\!\!
	\sum_{p \in \R \cup \{-\infty\}} \m_d(p,\infty) \ = \
	\sum_{p \in \R} \m_d(p,\infty),
	\end{equation*}
	which yields
	\begin{align*}
	c_{d}^{\epsilon} - p_{d} \ &=
	\sum_{\substack{(p,q) \in \R^2 \\ q-p > \epsilon}} \m_{d-1}(p,q) \ +
	\sum_{\substack{(p,q) \in \mulDom \\ q-p > \epsilon \\ p \neq -\infty}} \m_d(p,q) \ - \
	\sum_{p \in \R} \m_d(p,\infty) \\ &=
	\sum_{\substack{(p,q) \in \R^2 \\ q-p > \epsilon}} \m_{d-1}(p,q)
	\ + \!
	\sum_{\substack{(p,q) \in \R^2 \\ q-p > \epsilon}} \m_d(p,q),
	\end{align*}
	so the sequence given by
	\[\nu_d = \sum_{\substack{(p,q) \in \R^2 \\ q-p > \epsilon}} \m_d(p,q)\]
	satisfies the equation $c_{d}^{\epsilon} - p_{d} = \nu_{d-1} + \nu_{d}$ as desired.
\end{proof}

As shown in \cref{t:cap numbers well defined}, the finiteness assumptions are satisfied if $M$ is initially and eventually constant.
Hence, as a special case, the theorem yields generalized Morse inequalities for any bounded real-valued function whose sublevel set filtration has q-tame persistent homology, including classical Morse functions $f$ on closed smooth manifolds $X$.
As outlined in our motivation for the definition of cap numbers, in this setting our inequalities \eqref{e:morse inequalities} agree with the classical inequalities \eqref{e:classical morse inequalities}, as $\beta_d(X) = p_d$ and $c_d^{\epsilon} = \# \crit_d(f)$ for $\epsilon > 0$ smaller than the minimal difference between any two critical values of~$f$.
Morse inequalities for unbounded functions can still be obtained by restricting the function to an arbitrary sublevel set.

The finiteness conditions of our theorem are also satisfied for the Douglas functional considered by Morse and Tompkins as an application of Morse' theory of functional topology.
While the condition proposed by Morse turns out to be insufficient as shown in \cref{s:surfaces}, q-tameness is still guaranteed by \cref{t:local connectedness implies q-tameness} established in \cref{s:connectivity}.
As mentioned before, our inequalities then agree with Morse's historical version from functional topology as presented in \cite[Corollary~12.3]{Morse.1940} if the persistent homology of the sublevel set filtration is not only q-tame but also continuous from above, which is satisfied for compact sublevel set filtrations if one uses \v{C}ech homology, as is the case in Morse's work.
Note however that, in contrast to Morse's version, our inequalities also hold without the assumption of continuity from above, expanding their use beyond \v{C}ech type theories.

\begin{rem} \label{r:homotopically critial points}
	In addition to the formulation of the inequalities in terms of cap numbers, Morse also proposes a generalized version of critical points, which he calls homotopically critical, and which formalizes the idea of criticality of a point in terms of topological changes in the sublevel set filtration.
	This notion is employed by Morse and Tompkins in their study of minimal surfaces \cite{Morse.1939}, which we will partly review in \cref{s:surfaces} and for which a thorough historical account may be found in \cite[Section II.6]{Struwe.1988}.
	The usefulness of this notion might however be limited in many cases of interest.
	In Floer theory, for example, critical points of the action functional corresponding to a Hamiltonian usually have infinite index and thus do not produce changes in the topology.
	In this setting, our approach of formulating the inequalities purely in algebraic terms might be more suitable, because while these critical points are not topologically visible, they do correspond to features in the persistence diagram of the filtered Floer homology.
\end{rem}
